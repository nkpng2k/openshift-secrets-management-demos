apiVersion: console.openshift.io/v1
kind: ConsoleQuickStart
metadata:
  name: external-secrets-operator-install
spec:
  displayName: Install the external secrets operator for Red Hat OpenShift
  tags:
    - example
    - install
    - operator
  durationMinutes: 5
  description: |-
    Install the external secrets operator for Red Hat OpenShift to manage credentials sourced from an external secrets manager (Conjur, Vault)
  introduction: |-
    # External Secrets Operator for Red Hat OpenShift

    The external secrets operator enables you to bring secrets or other "confidential material" into an OpenShift cluster
    from an external source such as CyberArk Conjur, HashiCorp Vault, or any of the cloud service provider secrets managers.

    ### Usage

    You can use a `SecretStore` or `ClusterSecretStore` to define how to connect to the secrets manager, and
    use an `ExternalSecret` to define what credential to pull and where to place the credential in the
    OpenShift cluster. 
  tasks:
    - title: Install the external secrets operator for Red Hat OpenShift
      description: |-
        ### To install the operator:
        1. From the **Administrators** perspective, go to the **OperatorHub** from the [Operators]{{highlight qs-nav-operators}} section of the navigation.
        2. In the **Filter by keyword** field, type `External Secrets Operator`.
        3. Look for **External Secrets Operator for Red Hat OpenShift**. If the tile has an **Installed** label on it, the Operator is already installed, and you can close this Quick Start.
        4. Click the tile to open the side panel.
        5. At the top of the side panel, click **Install**.
        6. Verify that the **Operator Update Channel** is set to the latest version, then click **Install**. You may need to "Approve" the installation.
        7. Wait for the External Secrets Operator's status to change from **Installing operator** to **Operator installed - Ready for use**.
      review:
        instructions: |-
          #### Verify the operator was successfully installed:
        failedTaskHelp: This task isn’t verified yet. Try the task again.
      summary:
        success: You just installed the external secrets operator for Red Hat OpenShift!
        failed: Try the steps again.
    - title: Deploy the ExternalSecrets Operand
      description: |-
        ### The ExternalSecrets Operand
        Installing the external secrets operator provides you with the necessary APIs to deploy the ExternalSecrets operand.

        When an ExternalSecrets CR is deployed, a new Deployment is created that manages the external-secrets singleton and
        keeps it in the desired state.

        ### To deploy the ExternalSecrets Custom Resource:
        1. From the **Administrators** perspective, go to the **Installed Operators** from the [Operators]{{highlight qs-nav-operators}} section of the navigation.
        2. In the **Search by name** field, type `External Secrets Operator`.
        3. Click on the **external secrets operator for Red Hat OpenShift**
        4. Find the `ExternalSecrets` Custom Resource in the **Provided APIs** list or in the top side-scrolling menu bar.
          - NOTE: MAKE SURE YOU ARE SELECTING **ExternalSecrets** AND **NOT** **ExternalSecret**
          - From the list of **Provided APIs** click the **Create instance** link
          - From the **top side-scrolling menu bar** click **SecretStore** and then click **Create SecretStore**
        5. For this QuickStart, you can use the default configurations for the `ExternalSecrets` Deployment.
        6. Enter a name for the deployment, and then click **Create**
      review:
        instructions: |-
          #### Verify the operand was successfully installed:
          - Navigate to the [Workloads]{{highlight qs-nav-workloads}} section of the navigation, and click **Pods**
          - Change the **Project** at the top of the screen to `external-secrets`
          - Verify that there are 3 running pods.
            - external-secrets
            - external-secrets-cert-controller
            - external-secrets-webhook
        failedTaskHelp: This task isn’t verified yet. Try the task again.
      summary:
        success: You have completely deployed the external secrets operator for Red Hat OpenShift! Check out the next Quick Start for a simple example of how to use the Custom Resources provided by the operator.
        failed: Try the steps again.
  conclusion: 'Your external secrets operator is ready!'
