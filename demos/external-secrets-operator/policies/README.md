# Policies Demo

This is a simple demo using a `busybox` container image
to consume a `Secret` generated by a deployment of the
[External Secret Operator](https://external-secrets.io/). This demo
will also showcase the management policies for ESO including:
`creationPolicy`, `refreshPolicy`, and `deletionPolicy`

## Prerequisites

Must have the following installed:
- `oc`
- `helm`

Must have admin credentials for an OpenShift cluster and be logged in via:
`oc login ...`

## Steps

1. Make sure to have `oc` and `helm` installed
2. Make sure to log in with your admin credentials via `oc login` command
3. You can make edits to the `variables.sh` file if you want to configure
where to point the demo to for some things.
4. Run the scripts in order from the `src` folder:
```sh
# Installs the external secrets manager (Vault) and External Secret Operator
./01_install.sh 

# Configures the running Vault with some dummy values and enables Kubernetes auth
./02_add_secret_values.sh

# Deploys a sample application and performs a simple validation
./03_deploy_example_application.sh

# Updates the secret in Vault and waits for update to be pulled by ESO
./04_demo_eso_refresh_policies.sh

# Deletes the secret in Vault and waits for update to be pulled by ESO
./05_demo_eso_deletion_policies.sh

# Cleanup step. Tearsdown the resources created during the prior steps
./06_cleanup.sh
```

## Expected Output
1. At step 3, you should see success statements echoed to the terminal
2. At step 4, you should see success statements. Additionally, the
secret mounted as an Environment Variable will not have changed, but
the secret mounted to the pod as a volume will reflect the change to
Vault.
3. At step 5, you should see output logs for events attached to the
`ExternalSecret` CR. Additionally, you should see a success message
echoed to the terminal asserting the secret managed by the
`ExternalSecret` has been deleted.

## Disclaimer

This is not guaranteed to work in all environments, and is meant to showcase
an extremely simple example of how external secrets operator can consume secrets from
an external secret manager.
